generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model Customer {
  id            String         @id @default(cuid())
  phoneNumber   String         @unique
  name          String?
  createdAt     DateTime       @default(now())
  conversations Conversation[]
  messages      Message[]
}

model Message {
  id             String        @id @default(cuid())
  customerId     String
  customer       Customer      @relation(fields: [customerId], references: [id])
  conversationId String
  conversation   Conversation  @relation(fields: [conversationId], references: [id])
  direction      Direction
  type           MessageType
  content        String?
  imageUrl       String?
  status         MessageStatus @default(SENT)
  createdAt      DateTime      @default(now())
}

model Conversation {
  id            String    @id @default(cuid())
  customerId    String
  customer      Customer  @relation(fields: [customerId], references: [id])
  startedAt     DateTime  @default(now())
  lastMessageAt DateTime  @default(now())
  messageCount  Int       @default(0)
  isActive      Boolean   @default(true)
  messages      Message[]
}

model BotSettings {
  id             String  @id @default(cuid())
  botName        String  @default("AI Assistant")
  systemPrompt   String  @default("You are a helpful AI assistant.")
  welcomeMessage String  @default("Hello! How can I help you today?")
  maxTokens      Int     @default(1024)
  isActive       Boolean @default(true)
}

enum Direction {
  INBOUND
  OUTBOUND
}

enum MessageType {
  TEXT
  IMAGE
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
  FAILED
}
